<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xsens Device API: Workflow using the Xsens Awinda System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="xsens.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xsenslogo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xsens Device API
   &#160;<span id="projectnumber">2021.4.0</span>
   </div>
   <div id="projectbrief">Xsens Device API objects</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('awindaworkflow.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Workflow using the Xsens Awinda System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="s_intro"></a>
Introduction</h1>
<p>The following explains the recommended workflow when using the MTw Development Kit with XDA. The system, involving both the Awinda Master and the MTw, is known to be in certain states. Possible functionality is specifically related to a given state. The possible transitions from one state to another is limited. It is advised to understand the states and transitions of both the Awinda Master and of the MTw in order to work according to the recommended workflow as much as possible.</p>
<h1><a class="anchor" id="s_awsstates"></a>
Awinda Master states</h1>
<p>The figure below provides an overview of the states of the Awinda Master; The table describes these states and transitions with some suggestions for using XDA. </p><div class="doxyimage"> <div class="image">
<img src="diagram_awindamaster.png" alt=""/>
<div class="caption">
State Diagram of Awinda Station.</div></div>
 </div><p>The following table describes these states and transitions with some suggestions for using XDA. To see what XDA will output through its callbacks in each state, see <a class="el" href="awindaretransmissions.html">Retransmissions and Stream behaviour for Xsens Awinda Systems</a>.</p>
<table class="doxtable">
<tr>
<th>State </th><th>Description </th><th>Suggested Action  </th></tr>
<tr>
<td>Connecting </td><td>Awinda Master not yet connected to XDA </td><td>Do a port scan, open port and request device instance  </td></tr>
<tr>
<td>Connected </td><td>The Master is detected. The port is open and connected to XDA.<br  />
The radio of the Awinda Master is not yet transmitting. </td><td>Call <a class="el" href="struct_xs_device.html#a24af0dcccddf838764795b169213a9af" title="Set the radio channel to use for wireless communication.">XsDevice::enableRadio()</a> with the required radio channel.  </td></tr>
<tr>
<td>Enabled </td><td>The radio of the Awinda Master is switched on and broadcasting on the specified channel.<br  />
MTw's can detect this transmission and start to connect to the network. </td><td>Wait until all devices have joined the network.<br  />
Give the <a class="el" href="struct_xs_device.html#a71743a68785ec3af6c5c5763a69aca62" title="Put this device in measurement mode.">XsDevice::gotoMeasurement()</a> command.  </td></tr>
<tr>
<td rowspan="3">Measuring </td><td rowspan="3">The MTw's are measuring and transmitting data to the Master.<br  />
The Master forwards each data packet received to XDA. </td><td>Continue Measuring. </td></tr>
<tr>
<td>Return to the Config (Wireless) state to make changes to the wireless network using the <a class="el" href="struct_xs_device.html#a9ec3280fe994031d49975f99300ee5bb" title="Put the device in config mode.">XsDevice::gotoConfig()</a> command. </td></tr>
<tr>
<td>Enter Recording state using the <a class="el" href="struct_xs_device.html#a2b49e90836b702ba8d2d3ff7e5eb27d9" title="Start recording incoming data.">XsDevice::startRecording()</a> command.  </td></tr>
<tr>
<td>Config (Wireless) </td><td>The Master is operational, the wireless network is established.<br  />
No new MTw's can connect to the network. </td><td>Give the <a class="el" href="struct_xs_device.html#a71743a68785ec3af6c5c5763a69aca62" title="Put this device in measurement mode.">XsDevice::gotoMeasurement()</a> command to start measuring, or <a class="el" href="struct_xs_device.html#aa45e631a78e1eb13b2068f3aacf02f8e" title="Disables the radio for this station, resetting all children to disconnected state.">XsDevice::disableRadio()</a> to switch the radio off on the Awinda Master, and return to Enabled state.  </td></tr>
<tr>
<td rowspan="2">Recording </td><td rowspan="2">Recording is in progress.<br  />
A new file is created, wherein transmitted data is stored.<br  />
If the maximum update rate was chosen, recorded data cannot contain retransmitted data. If a lower update rate is selected, the recording will contain retransmissions when necessary. </td><td>Continue recording. </td></tr>
<tr>
<td>Return to measurement state, using the command stopRecording.  </td></tr>
<tr>
<td rowspan="3">Flushing </td><td rowspan="3">Recording was stopped. Data still on the buffer of the MTw are retransmitted to the Awinda Master. </td><td>Wait until flushing is complete. </td></tr>
<tr>
<td>Close the logfile using <a class="el" href="struct_xs_device.html#a517288ec25530fc1ef25c1688bab7bcf" title="Close the log file.">XsDevice::closeLogFile()</a>. </td></tr>
<tr>
<td>Return to Enabled state using <a class="el" href="struct_xs_device.html#a9ec3280fe994031d49975f99300ee5bb" title="Put the device in config mode.">XsDevice::gotoConfig()</a>.  </td></tr>
</table>
<h1><a class="anchor" id="s_mtwstates"></a>
Mtw states</h1>
<p>The figure below provides an overview of the states of an MTw; The table describes these states and transitions with some suggestions for using XDA. </p><div class="doxyimage"> <div class="image">
<img src="diagram_mtw.png" alt=""/>
<div class="caption">
State Diagram of MTw.</div></div>
 </div><p>The following table describes these states and transitions with some suggestions for using XDA. </p><table class="doxtable">
<tr>
<th>State </th><th>Description </th><th>Suggested Action  </th></tr>
<tr>
<td>Sleep </td><td>Power saving state to which the MTw enters if it is idle for some time. </td><td>Rotate the MTw to return to scanning state.<br  />
Dock the MTw into the Awinda Station to enter Config state.  </td></tr>
<tr>
<td>Scanning </td><td>MTw scans all radio channels to find a Master in the Enabled state. </td><td>Wait until connected indications are received. (see Enabled state of the Awinda Master).  </td></tr>
<tr>
<td>Config (Wireless) </td><td>MTw is wirelessly connected to a Master but not yet measuring. </td><td>None. MTw is controlled by Master.  </td></tr>
<tr>
<td>Measuring (Wireless) </td><td>MTw is wirelessly connected to a Master and in measuring state. </td><td>None. MTw is controlled by Master.  </td></tr>
<tr>
<td rowspan="3">Config (Wired) </td><td rowspan="3">Device is docked.<br  />
Configurations can be changed. (not intended use) </td><td>Configure the device. </td></tr>
<tr>
<td>Undock device to start scanning for a Master. </td></tr>
<tr>
<td>Start measurement while docked (not intended use).  </td></tr>
<tr>
<td rowspan="2">Measuring (Wired) </td><td rowspan="2">MTw is wired or docked and in measuring state </td><td>Undock device to start scanning for a Master. </td></tr>
<tr>
<td>Stop measurement while docked to enter config state.  </td></tr>
</table>
<h1><a class="anchor" id="s_workflow"></a>
Work Flow</h1>
<p>This section shows the necessary steps required to start a recording on an Awinda Master with multiple wireless MTw's and process the generated data using XDA.</p>
<ul>
<li>
Startup phase  <ol>
<li>
<p class="startli">Initialize XDA </p><div class="groupText"> The application starts with the creation of an <a class="el" href="struct_xs_control.html" title="High level Motion Tracker (MT) management class.">XsControl</a> object using the <a class="el" href="struct_xs_control.html#a6c54fd6126e517381f9a063c5fb8a117" title="Construct a new XsControl* object. Clean it up with the destruct() function or delete the object.">XsControl::construct</a> function. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Discover devices </p><div class="groupText"> The application detects devices available to the system using the <a class="el" href="class_xs_scanner.html#a42f1eac216fdfa16fd001264d7763202" title="Scan all ports for Xsens devices.">XsScanner::scanPorts</a> function. This function will return all communication ports to which Xsens devices are connected. Check using <a class="el" href="struct_xs_device_id.html#a96c28cf2b874d030f61bd6ab81641900" title="Test if this device ID represents a Wireless Master device (Awinda Station, Awinda Dongle,...">XsDeviceId::isWirelessMaster</a> for available Awinda Systems </div><p class="endli"></p>
</li>
<li>
<p class="startli">Open devices of interest </p><div class="groupText"> The port information obtained in the previous step is used to open devices of interest using the <a class="el" href="struct_xs_control.html#a0dcd5f3427b7509b07baf64650e56dbd" title="Open a communication channel on serial port with the given portname.">XsControl::openPort</a> function. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Configure devices </p><div class="groupText"> If needed the application configures the open devices. Through the <a class="el" href="struct_xs_control.html#a908f5a025aef35e11a4e4583eb0c55a8" title="Returns the XsDevice interface object associated with the supplied deviceId.">XsControl::device</a> function the application obtains <a class="el" href="struct_xs_device.html" title="A pointer to an XsDevice object.">XsDevice</a> instances required to do the configuration. Typical configuration actions are setting the output data format and data rate to the desired values. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Prepare for data handling (event based) </p><div class="groupText"> With event based data handling the application is signalled with an <a class="el" href="struct_xs_data_packet.html" title="Contains an interpreted data message. The class provides easy access to the contained data through it...">XsDataPacket</a> as soon as it arrives. To enable this a callback object must be registered. The application creates an object derived from <a class="el" href="class_xs_callback.html" title="Structure that contains callback functions for the Xsens Device API.">XsCallback</a> that overrides the <a class="el" href="group___callbacks.html#gaf94a5a76c3a443255fc53f7a2bf9e076" title="Called when new data has been received from a device or read from a file. When processing on PC is en...">XsCallback::onLiveDataAvailable</a> function. The object is registered with XDA using the <a class="el" href="struct_xs_control.html#a189065247d7fb3758a355c403c68866d" title="Add a callback handler to the list.">XsControl::addCallbackHandler</a> function. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Configure Awinda Master </p><div class="groupText"> Set the desired update rate using <a class="el" href="struct_xs_device.html#a43f1e4fe0a563c86f40a663e113b1bbf" title="Set the legacy update rate of the device.">XsDevice::setUpdateRate</a> </div><p class="endli"></p>
</li>
<li>
<p class="startli">Enable the radio </p><div class="groupText"> Set the radio channel and enable the radio. The available channels are 11 to 26. When expecting interference with WIFI devices, try Channels 15 and 20 or 25 and 26, see MTw User Manual for more information.<br  />
 When the radio is enabled, MTw's can wirelessly connect to the Master. Undock the required MTw's and wait for a connection to be established. When an MTw connects, the <a class="el" href="group___callbacks.html#gacad6280b5dc0c8e458b22e26a50bad40" title="Called when XDA has detected a change in the connectivity state of a device.">XsCallback::onConnectivityChanged</a> callback is called, which provides the MTw's <a class="el" href="struct_xs_device.html" title="A pointer to an XsDevice object.">XsDevice</a> instance and the new XsConnectivityState, which should be XCS_Wireless.<br  />
 <a class="el" href="struct_xs_device.html" title="A pointer to an XsDevice object.">XsDevice</a> instances of connected MTw's are not yet fully functional at this stage. When the MTw's are in measurement mode, the full functionality will be available. When all MTw's are connected, the measurement can be started. Use the <a class="el" href="struct_xs_device.html" title="A pointer to an XsDevice object.">XsDevice</a> instance of the Master to put the Master and all wirelessly connected MTw's into measurement mode. </div><p class="endli"></p>
</li>
<li>
<p class="startli">Switch devices to measurement mode </p><div class="groupText"> The devices are set to measurement mode. The application can do this either per <b>main</b> device with the <a class="el" href="struct_xs_device.html#a71743a68785ec3af6c5c5763a69aca62" title="Put this device in measurement mode.">XsDevice::gotoMeasurement</a> function or for all devices simultaneously using <a class="el" href="struct_xs_control.html#a7e568e756863a1b90156a3edf11a6126" title="Place all sensors connected through a serial port into Measurement Mode.">XsControl::gotoMeasurement</a> </div><p class="endli"></p>
</li>
</ol>
</li>
<li>
Processing phase  <ol>
<li>
<p class="startli">Handle incoming data </p><div class="groupText"> The onPostProcess function of the callback object registered in the startup phase will be called whenever new data is available. The function gets a pointer to the newly available <a class="el" href="struct_xs_data_packet.html" title="Contains an interpreted data message. The class provides easy access to the contained data through it...">XsDataPacket</a> as parameter. The <a class="el" href="struct_xs_data_packet.html#a5d5de9e35c85b44c0158e1389ada848a" title="Return the device ID associated with the data packet.">XsDataPacket::deviceId</a> function is used to determine from which device the packet is received. Refer to <a class="el" href="overview.html#s_concurrency">Concurrency</a> for a more indepth view on event based data handling </div><p class="endli"></p>
</li>
<li>
<p class="startli">Check for completion </p><div class="groupText"> The application checks the conditions required for process completion, these are application defined. If the conditions are met the Exit phase is entered </div><p class="endli"></p>
</li>
</ol>
</li>
<li>
Exit phase  <ol>
<li>
<p class="startli">Close open devices </p><div class="groupText"> All open devices are closed. The application uses the <a class="el" href="struct_xs_control.html#a9b3617d4a55cf48ddf7257788e1d5a79" title="Close the serial port with the given portname.">XsControl::closePort</a> function on each openend device to do this or the Xscontrol::close function to close all open devices. Closing the device will automatically change the state of the device from measurement mode to config mode. </div><p class="endli"></p>
</li>
<li>
Clean up XDA <div class="groupText"> The application releases the <a class="el" href="struct_xs_control.html" title="High level Motion Tracker (MT) management class.">XsControl</a> object created at startup using the <a class="el" href="struct_xs_control.html#a383124de0bf073f72800eb1905008eee" title="Destruct a XsControl object and free all memory allocated for it.">XsControl::destruct</a> function. </div> </li>
</ol>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
